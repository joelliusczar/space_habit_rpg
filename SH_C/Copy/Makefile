SHDATETIME_PATH = ../SHDatetime/
SH_TOOLS_PATH = ../SH_CTools/
include ../SHBase.mk
include $(SHDATETIME_PATH)vars.mk
include $(SH_TOOLS_PATH)vars.mk
include vars.mk
SOURCE?=Daily
SH_TOP_FULL=$(call libfy,$(SH_TOP))
DT_SHARED_S=$(DT_SHARED)$(SOURCE)
SH_TOOLS_S=$(SH_TOOLS)$(SOURCE)
DT_SHARED_FULL := $(SHDATETIME_PATH)$(call libfy,$(DT_SHARED_S))
SH_TOOLS_FULL := $(SH_TOOLS_PATH)$(call libfy,$(SH_TOOLS_S))
INC+=-I$(SHDATETIME_PATH) -I$(SH_TOOLS_PATH)
SH_TOOLS_HEADERS = $(call rwildcard,$(SH_TOOLS_PATH),*.h)
SH_TOOLS_SOURCES = $(call rwildcard,$(SH_TOOLS_PATH),*.c)
SH_TOOLS_OBJECTS=$(SH_TOOLS_SOURCES:.c=.o)
SHDATETIME_HEADERS:= $(call rwildcard,$(SHDATETIME_PATH),*.h)
SHDATETIME_SOURCES:= $(call rwildcard,$(SHDATETIME_PATH),*.c)
SHDATETIME_OBJECTS=$(SHDATETIME_SOURCES:.c=.o)
PARENT_PATH ?= .

.DEFAULT_GOAL:=$(SH_TOP_FULL)


$(SH_TOP_FULL): $(OBJECTS) $(DT_SHARED_FULL) $(SH_TOOLS_FULL)
	$(CC) $(INC) $(CFLAGS) $(OBJECTS) -Wl,-rpath,$(SHDATETIME_PATH),-rpath,$(SH_TOOLS_PATH) \
	-L$(SHDATETIME_PATH) -L$(SH_TOOLS_PATH) -l$(DT_SHARED_S) -l$(SH_TOOLS_S) \
	-shared -o $(SH_TOP_FULL)

$(DT_SHARED_FULL): $(SHDATETIME_OBJECTS) $(SH_TOOLS_OBJECTS)
	cd $(SHDATETIME_PATH) && $(MAKE) PARENT_PATH=$(SHDATETIME_PATH) SOURCE=$(SOURCE) 


clean:
	cd .. && $(MAKE) clean
